<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text Animation</title>
  <style>
    /* Video container: 75% of browser width, 16:9 aspect ratio */
    #videoContainer {
      position: relative;
      width: 75vw;
      aspect-ratio: 16/9;
      overflow: hidden;
      margin: 0 auto;
    }
    #videoContainer video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* Wrapper for both text lines, positioned -640px from center */
    #textWrapper {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-640px);
      width: 100%;
      height: 100%;
    }

    /* Shared text styles, centered on wrapper origin */
    #text, #text2 {
      position: absolute;
      left: 0;
      transform: translateX(-50%);
      color: #fff;
      text-align: center;
      white-space: pre-wrap;
    }
    #text {
      top: 45%; /* lower position */
      font-size: 1.5vw;
    }
    #text2 {
      top: 50%; /* a bit lower than text1 */
      font-size: 1vw;
      width: 16vw;
    }

    @keyframes slideFade {
      from {
        opacity: 0;
        transform: translateX(calc(-50% - 10px));
      }
      to {
        opacity: 1;
        transform: translateX(-50%);
      }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to   { opacity: 0; }
    }

    .char, .word {
      display: inline-block;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="videoContainer">
    <video autoplay muted playsinline preload="auto">
      <source src="https://static.originmedia.tv/website/internal/sample.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div id="textWrapper">
      <div id="text"></div>
      <div id="text2"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      const fps = 24;

      // Fetch TSV from Google Sheets (two columns: first line -> #text, second -> #text2)
      const tsvUrl = 'https://static.originmedia.tv/website/internal/maine-overlaytest.tsv';
      const resp = await fetch(tsvUrl);
      const tsv = await resp.text();
      const rows = tsv.trim().split('\n').map(r => r.split('\t'));
      rows.shift(); // remove header row
      const randomRow = rows[Math.floor(Math.random() * rows.length)];
      const [text1Str, text2Str] = randomRow;

      // Set text content
      const container1 = document.getElementById('text');
      const container2 = document.getElementById('text2');
      container1.textContent = text1Str;
      container2.textContent = text2Str;

      // Animate first DIV: per-character
      const startFrame1 = 76;
      const letterDuration = 16 / fps;
      const textContent1 = container1.textContent;
      container1.textContent = '';
      Array.from(textContent1).forEach((char, i) => {
        const span = document.createElement('span');
        span.classList.add('char');
        span.textContent = char;
        const delay = (startFrame1 + i) / fps;
        span.style.animation = `slideFade ${letterDuration}s ease-out forwards`;
        span.style.animationDelay = `${delay}s`;
        container1.appendChild(span);
      });

      // Animate second DIV: per-word
      const startFrame2 = 86;
      const wordDuration = 27 / fps;
      const textContent2 = container2.textContent;
      container2.textContent = '';
      textContent2.split(' ').forEach((word, i, arr) => {
        const span = document.createElement('span');
        span.classList.add('word');
        span.textContent = word;
        const delay = (startFrame2 + i) / fps;
        span.style.animation = `slideFade ${wordDuration}s ease-out forwards`;
        span.style.animationDelay = `${delay}s`;
        container2.appendChild(span);
        if (i < arr.length - 1) container2.appendChild(document.createTextNode(' '));
      });

      // Fade out wrapper at frame 260 over 7 frames
      const fadeStart = 260 / fps;
      const fadeDuration = 7 / fps;
      const wrapper = document.getElementById('textWrapper');
      wrapper.style.animation = `fadeOut ${fadeDuration}s ease-out forwards`;
      wrapper.style.animationDelay = `${fadeStart}s`;
    });
  </script>
</body>
</html>
