<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Overlay Animation</title>
  
  <!-- Preload fonts for immediate availability -->
  <link rel="preload" href="https://raw.githubusercontent.com/originmediastudio/overlaydemos/main/fonts/subset-TTRamillas-Light.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://raw.githubusercontent.com/originmediastudio/overlaydemos/main/fonts/subset-MacysSans-Bold.woff2" as="font" type="font/woff2" crossorigin>
  
  <style>
    /* Load subsetted fonts from GitHub (WOFF2 only for smallest size) */
    @font-face {
      font-family: 'TT Ramillas';
      src: url('https://raw.githubusercontent.com/originmediastudio/overlaydemos/main/fonts/subset-TTRamillas-Light.woff2') format('woff2');
      font-weight: 300;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Macys Sans';
      src: url('https://raw.githubusercontent.com/originmediastudio/overlaydemos/main/fonts/subset-MacysSans-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
      font-display: swap;
    }

    /* Reset and transparent background */
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* Wrapper for both text lines */
    #textWrapper {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
                background-image: url(macys-base.png);
          background-repeat: no-repeat;
  background-size: contain;


    }

    /* Shared text styles */
    #text1, #text2 {
      position: absolute;
      left: 41.5%;
      color: #fff;
      text-align: center;
    }
    /* Prevent wrapping and enable baseline anchoring */
    #text1 {
      bottom: 75%;
      font-size: 5.5vw;
      white-space: nowrap;
      font-family: 'TT Ramillas', serif;
      letter-spacing: -0.05em;
      transform-origin: left bottom;
        margin-left:-.3vw;
    }
    #text2 {
      bottom: 69%;
      font-size: 2.3vw;
      white-space: pre-wrap;
      line-height: 1.2;
      font-family: 'Macys Sans', sans-serif;
      text-transform: uppercase;
    }

    @keyframes slideFade {
      from { opacity: 0; transform: translateX(10px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to   { opacity: 0; }
    }
    .char, .word {
      display: inline-block;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="textWrapper">
    <div id="text1">King's Plaza Shopping Center</div>
    <div id="text2">in Brooklyn</div>
  </div>

 <script>
    (function() {
      // CONFIGURATION - Set framerate here
      const fps = 24;
      const startFrame1 = 348;
      const startFrame2 = 358;
      const letterFrames = 18;
      const wordFrames = 28;
      const fadeStartFrame = 710;
      const fadeFrames = 8;

      let handshakeTime = 0;
      let handshakeVideoTime = 0;
      let campaignDataReceived = false;
      let receivedCampaignData = null;

      window.addEventListener('message', function handler(e) {
        if (e.data === 'parentLoaded') {
          parent.postMessage('overlayReady', '*');
        }
        if (e.data && e.data.type === 'init') {
          handshakeTime = performance.now();
          handshakeVideoTime = e.data.currentTime;
          if (campaignDataReceived) setupAnimations();
        }
        if (e.data && e.data.type === 'campaignData') {
          receivedCampaignData = e.data;
          campaignDataReceived = true;
          if (handshakeTime > 0) setupAnimations();
        }
      });

      function setupAnimations() {
        const now = performance.now();
        const videoTime = handshakeVideoTime + (now - handshakeTime) / 1000;

        // Extract text from campaign data
        const t1 = receivedCampaignData.text1 || "Default Text 1";
        const t2 = receivedCampaignData.text2 || "Default Text 2";

        const c1 = document.getElementById('text1');
        const c2 = document.getElementById('text2');

        // Clear and populate first line per character
        c1.textContent = '';
        Array.from(t1).forEach((char, i) => {
          const span = document.createElement('span');
          span.className = 'char';
          span.textContent = char;
          span.style.animation = `slideFade ${letterFrames / fps}s ease-out forwards`;
          span.style.animationDelay = `${Math.max((startFrame1 + i) / fps - videoTime, 0)}s`;
          c1.appendChild(span);
        });

        // Dynamic resize: shrink if wider than 55% of wrapper
        const wrapper = document.getElementById('textWrapper');
        const maxWidth = wrapper.clientWidth * 0.55;
        const actualWidth = c1.offsetWidth;
        if (actualWidth > maxWidth) {
          const scale = maxWidth / actualWidth;
          c1.style.transform = `scale(${scale})`;
        } else {
          c1.style.transform = `scale(1)`;
        }

        // Populate second line per word
        c2.textContent = '';
        t2.split(' ').forEach((word, i, arr) => {
          const span = document.createElement('span');
          span.className = 'word';
          span.textContent = word;
          span.style.animation = `slideFade ${wordFrames / fps}s ease-out forwards`;
          span.style.animationDelay = `${Math.max((startFrame2 + i) / fps - videoTime, 0)}s`;
          c2.appendChild(span);
          if (i < arr.length - 1) c2.appendChild(document.createTextNode(' '));
        });

        // Fade out wrapper
        const fadeDelay = (fadeStartFrame / fps) - videoTime;
        wrapper.style.animation = `fadeOut ${fadeFrames / fps}s ease-out forwards`;
        wrapper.style.animationDelay = `${Math.max(fadeDelay, 0)}s`;
      }
    })();
  </script>
</body>
</html>
